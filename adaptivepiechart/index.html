<!DOCTYPE HTML>
<meta charset="utf-8">
<html>
<style>

</style>

<body>
  Number of datapoints: 
  <input id="datacount" onkeyup="render()" value="20" name="datapoints"></input>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>
var width = 960,
    height = 500;

var color = d3.scale.category20();

var svg = d3.select("body").append("svg")
  .attr("width", width).attr("height", height);

var min = Math.min(width, height);
var oRadius = min / 2 * 0.9;
var iRadius = min / 2 * 0.85;

// calculates values
var pie = d3.layout.pie().value(function(d){ return d; }).sort(null);

// arc path calculator
var arc = d3.svg.arc()
  .outerRadius(oRadius)
  .innerRadius(iRadius);

// creates the container
var g = svg.append('g')
  .attr('transform', 'translate(' + width / 2 + ',' + height / 2 + ')'); 

var data = makeData(+document.getElementById("datacount").value);
var path = g.datum(data).selectAll("path")
  .data(pie)
  .enter().append("path")
    .attr("class","piechart")
    .attr("fill", function(d,i){ return color(i); })
    .attr("d", arc)
    .each(function(d){ this._current = d; })

function render(){
  // make new data
  data = makeData(+document.getElementById("datacount").value);
  // add transition to new path
  g.datum(data).selectAll("path").data(pie).transition().duration(1000).attrTween("d", arcTween)

  // add any new paths
  g.datum(data).selectAll("path")
    .data(pie)
  .enter().append("path")
    .attr("class","piechart")
    .attr("fill", function(d,i){ return color(i); })
    .attr("d", arc)
    .each(function(d){ this._current = d; })

  // remove data not being used
  g.datum(data).selectAll("path")
    .data(pie).exit().remove();
}

render();
setInterval(render,2000)


function makeData(size){
  return d3.range(size).map(function(item){
   return Math.random()*100;
  });
};

// Store the displayed angles in _current.
// Then, interpolate from _current to the new angles.
// During the transition, _current is updated in-place by d3.interpolate.
function arcTween(a) {
  var i = d3.interpolate(this._current, a);
  this._current = i(0);
  return function(t) {
    return arc(i(t));
  };
}

</script>
</body>